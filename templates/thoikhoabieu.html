<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Thời khóa biểu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8fafc; }
        .main-card { max-width: 1200px; margin: 40px auto; padding: 32px; border-radius: 16px; box-shadow: 0 4px 24px rgba(0,0,0,0.08); }
        /* Tăng khoảng cách bảng thời khóa biểu */
        .table.tkbcustom th, .table.tkbcustom td {
            padding: 16px 18px !important;
            text-align: center;
            vertical-align: middle !important;
            font-size: 1.08rem;
            white-space: nowrap; /* Giữ nội dung trên một dòng */
        }
        .table.tkbcustom td.wrap-text {
            white-space: normal; /* Cho phép xuống dòng cho cột này */
        }
        .table.tkbcustom thead th {
            background: #e9ecef;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        .table.tkbcustom tr {
            border-bottom: 2px solid #dee2e6;
        }
        .table.tkbcustom tbody tr:hover {
            background: #f1f3f6;
        }
        /* Responsive cho bảng */
        @media (max-width: 768px) {
            .main-card { padding: 8px; }
            .table.tkbcustom th, .table.tkbcustom td { padding: 8px 6px !important; font-size: 0.98rem; }
        }
    </style>
</head>
<body>
<div class="main-card bg-white">
    <h2 class="mb-4">Thời khóa biểu</h2>
    <div id="tkb_table" class="table-responsive">Đang tải...</div>
    <a href="/" class="btn btn-secondary mt-3">Quay lại trang chủ</a>
    <button type="button" class="btn btn-info mt-3 ms-2" data-bs-toggle="modal" data-bs-target="#timeTableModal">
        Xem Thời Gian Biểu
    </button>
</div>

<!-- Modal -->
<div class="modal fade" id="timeTableModal" tabindex="-1" aria-labelledby="timeTableModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="timeTableModalLabel">Thời Gian Biểu Chi Tiết</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <table class="table table-bordered table-striped align-middle">
                    <thead>
                        <tr>
                            <th>Tiết</th>
                            <th>Bắt đầu</th>
                            <th>Kết thúc</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>1</td><td>6:45</td><td>7:35</td></tr>
                        <tr><td>2</td><td>7:40</td><td>8:30</td></tr>
                        <tr><td>3</td><td>8:40</td><td>9:30</td></tr>
                        <tr><td>4</td><td>9:40</td><td>10:30</td></tr>
                        <tr><td>5</td><td>10:35</td><td>11:25</td></tr>
                        <tr><td>6</td><td>13:00</td><td>13:50</td></tr>
                        <tr><td>7</td><td>13:55</td><td>14:45</td></tr>
                        <tr><td>8</td><td>14:55</td><td>15:45</td></tr>
                        <tr><td>9</td><td>15:55</td><td>16:45</td></tr>
                        <tr><td>10</td><td>16:50</td><td>17:40</td></tr>
                        <tr><td>11</td><td>18:15</td><td>19:05</td></tr>
                        <tr><td>12</td><td>19:10</td><td>20:00</td></tr>
                        <tr><td>13</td><td>20:05</td><td>20:55</td></tr>
                        <tr><td>14</td><td>20:20</td><td>21:10</td></tr>
                        <tr><td>15</td><td>21:20</td><td>22:10</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const tkbTableDiv = document.getElementById('tkb_table');

        async function fetchTimetable() {
            tkbTableDiv.innerHTML = 'Đang tải...';
            try {
                const response = await fetch('/api/timetable');
                const data = await response.json();

                if (data.error) {
                    tkbTableDiv.textContent = data.message || 'Lỗi tải thời khóa biểu';
                    return;
                }

                if (!data.timetable || data.timetable.length === 0) {
                    tkbTableDiv.textContent = data.message || 'Bạn chưa có thời khóa biểu.';
                    return;
                }

                let html = `<table class="table table-bordered table-striped align-middle tkbcustom">
                    <thead class="table-light">
                        <tr>
                            <th>Lớp học phần</th>
                            <th>Thứ</th>
                            <th>Tiết</th>
                            <th>Buổi học</th> <!-- Thêm cột Buổi học -->
                            <th>Phòng</th>
                            <th>Giảng viên</th>
                            <th>Link Meet</th>
                            <th>Ngày học</th>
                        </tr>
                    </thead>
                    <tbody>`;
                data.timetable.forEach(e => {
                    const meetLinkHtml = e.meetLink ? `<a href="${e.meetLink}" target="_blank">Link</a>` : '';
                    html += `<tr class="align-middle">
                        <td class="wrap-text">${e.lopHocPhan || ''}</td>
                        <td>${e.thoiGian || ''}</td>
                        <td>${e.tiet || ''}</td>
                        <td>${e.buoiHoc || ''}</td>
                        <td>${e.phong || ''}</td>
                        <td>${e.giangVien || ''}</td>
                        <td>${meetLinkHtml}</td>
                        <td>${e.from_date || ''}</td>
                    </tr>`;
                });
                html += '</tbody></table>';
                tkbTableDiv.innerHTML = html;

            } catch (error) {
                console.error('Failed to fetch timetable:', error);
                tkbTableDiv.textContent = 'Không thể tải thời khóa biểu. Vui lòng thử lại sau.';
            }
        }

        fetchTimetable();
    });
</script>
</body>
</html>
